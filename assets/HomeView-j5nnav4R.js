const __vite__fileDeps=["assets/AuthView-BUrdN3Pj.js","assets/index-CFz4G1Ud.js","assets/index-BFfoNumw.css","assets/utils-DnNDQBbQ.js","assets/DesktopView-Cu-wA8Ox.js","assets/index-DCMURul0.js","assets/DesktopView-BZd6cSvt.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var E=Object.defineProperty;var U=(e,s,i)=>s in e?E(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i;var n=(e,s,i)=>(U(e,typeof s!="symbol"?s+"":s,i),i);import{o as y,c as R,d as D,a as N,b as j,e as v,u as b,w as P,S as V,f as C,g as I,h as O,_ as T}from"./index-CFz4G1Ud.js";const q=(e,s)=>{const i=e.__vccOpts||e;for(const[t,a]of s)i[t]=a;return i},G={},H={class:"blob w-[10%] aspect-square"};function J(e,s){return y(),R("div",H)}const x=q(G,[["render",J],["__scopeId","data-v-a5ee122f"]]);function _(e){return`https://${e}-geminios-backend-g9k2.encr.app`}class W{constructor(s="prod",i){n(this,"user");n(this,"verify");!s.startsWith("http://")&&!s.startsWith("https://")&&(s=_(s)),typeof i=="string"&&(i={auth:i});const t=new Y(s,i??{});this.user=new w.ServiceClient(t),this.verify=new S.ServiceClient(t)}}var w;(e=>{class s{constructor(t){n(this,"baseClient");this.baseClient=t}async ActivateGeminiPassReward(t){return await(await this.baseClient.callAPI("POST","/user/geminipass/activate",JSON.stringify(t))).json()}async AuthenticateUser(t){return await(await this.baseClient.callAPI("POST","/user/authenticate",JSON.stringify(t))).json()}async CheckEmail(t){return await(await this.baseClient.callAPI("POST","/user/check-email",JSON.stringify(t))).json()}async CheckUsername(t){return await(await this.baseClient.callAPI("POST","/user/check-username",JSON.stringify(t))).json()}async ClaimGeminiPassReward(t){return await(await this.baseClient.callAPI("POST","/user/geminipass/claim",JSON.stringify(t))).json()}async CreateUser(t){return await(await this.baseClient.callAPI("POST","/user",JSON.stringify(t))).json()}async DiscordCallback(t){const a=B({code:t.Code});await this.baseClient.callAPI("GET","/discord/callback",void 0,{query:a})}async GetDesktopSettings(){return await(await this.baseClient.callAPI("GET","/user/desktop/settings")).json()}async GetDiscordConnectionURL(){return await(await this.baseClient.callAPI("GET","/discord/connection_url")).json()}async GetGeminiPassClaims(){return await(await this.baseClient.callAPI("GET","/user/geminipass/claims")).json()}async GetGeminiPassLevel(){return await(await this.baseClient.callAPI("GET","/user/geminipass/level")).json()}async GetGeminiPassSchedule(){return await(await this.baseClient.callAPI("GET","/user/geminipass/schedule")).json()}async UpdateDesktopSettings(t){return await(await this.baseClient.callAPI("PUT","/user/desktop/settings",JSON.stringify(t))).json()}async ValidateSessionToken(t){return await(await this.baseClient.callAPI("POST","/auth/token/validate",JSON.stringify(t))).json()}}e.ServiceClient=s})(w||(w={}));var S;(e=>{class s{constructor(t){n(this,"baseClient");this.baseClient=t}async CheckRegistrationSession(t){return await(await this.baseClient.callAPI("POST","/verify/register/check",JSON.stringify(t))).json()}async CreateRegistrationSession(t){return await(await this.baseClient.callAPI("POST","/verify/register",JSON.stringify(t))).json()}async ResendEmailOTP(t){return await(await this.baseClient.callAPI("POST","/verify/email/resend",JSON.stringify(t))).json()}async SendEmailOTP(t){return await(await this.baseClient.callAPI("POST","/verify/email",JSON.stringify(t))).json()}async ValidateEmailOTP(t){return await(await this.baseClient.callAPI("POST","/verify/email/validate",JSON.stringify(t))).json()}}e.ServiceClient=s})(S||(S={}));function f(e){const s=[];for(const i in e){const t=Array.isArray(e[i])?e[i]:[e[i]];for(const a of t)s.push(`${i}=${encodeURIComponent(a)}`)}return s.join("&")}function B(e){for(const s in e)e[s]===void 0&&delete e[s];return e}function $(e){return"encore.dev.headers."+btoa(JSON.stringify(e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class k{constructor(s,i){n(this,"ws");n(this,"hasUpdateHandlers",[]);let t=["encore-ws"];i&&t.push($(i)),this.ws=new WebSocket(s,t),this.on("error",()=>{this.resolveHasUpdateHandlers()}),this.on("close",()=>{this.resolveHasUpdateHandlers()})}resolveHasUpdateHandlers(){const s=this.hasUpdateHandlers;this.hasUpdateHandlers=[];for(const i of s)i()}async hasUpdate(){await new Promise(s=>{this.hasUpdateHandlers.push(()=>s(null))})}on(s,i){this.ws.addEventListener(s,i)}off(s,i){this.ws.removeEventListener(s,i)}close(){this.ws.close()}}class z{constructor(s,i){n(this,"socket");n(this,"buffer",[]);this.socket=new k(s,i),this.socket.on("message",t=>{this.buffer.push(JSON.parse(t.data)),this.socket.resolveHasUpdateHandlers()})}close(){this.socket.close()}async send(s){return this.socket.ws.readyState===WebSocket.CONNECTING&&await new Promise(i=>{this.socket.ws.addEventListener("open",i,{once:!0})}),this.socket.ws.send(JSON.stringify(s))}async next(){for await(const s of this)return s}async*[Symbol.asyncIterator](){for(;;)if(this.buffer.length>0)yield this.buffer.shift();else{if(this.socket.ws.readyState===WebSocket.CLOSED)return;await this.socket.hasUpdate()}}}class M{constructor(s,i){n(this,"socket");n(this,"buffer",[]);this.socket=new k(s,i),this.socket.on("message",t=>{this.buffer.push(JSON.parse(t.data)),this.socket.resolveHasUpdateHandlers()})}close(){this.socket.close()}async next(){for await(const s of this)return s}async*[Symbol.asyncIterator](){for(;;)if(this.buffer.length>0)yield this.buffer.shift();else{if(this.socket.ws.readyState===WebSocket.CLOSED)return;await this.socket.hasUpdate()}}}class K{constructor(s,i){n(this,"socket");n(this,"responseValue");let t;this.responseValue=new Promise(a=>t=a),this.socket=new k(s,i),this.socket.on("message",a=>{t(JSON.parse(a.data))})}async response(){return this.responseValue}close(){this.socket.close()}async send(s){return this.socket.ws.readyState===WebSocket.CONNECTING&&await new Promise(i=>{this.socket.ws.addEventListener("open",i,{once:!0})}),this.socket.ws.send(JSON.stringify(s))}}const Q=fetch.bind(void 0);class Y{constructor(s,i){n(this,"baseURL");n(this,"fetcher");n(this,"headers");n(this,"requestInit");n(this,"authGenerator");if(this.baseURL=s,this.headers={"Content-Type":"application/json"},typeof window>"u"&&(this.headers["User-Agent"]="geminios-backend-g9k2-Generated-TS-Client (Encore/v1.41.1)"),this.requestInit=i.requestInit??{},i.fetcher!==void 0?this.fetcher=i.fetcher:this.fetcher=Q,i.auth!==void 0){const t=i.auth;typeof t=="function"?this.authGenerator=t:this.authGenerator=()=>t}}async getAuthData(){let s;if(this.authGenerator){const i=this.authGenerator();i instanceof Promise?s=await i:s=i}if(s){const i={};return i.headers={},i.headers.Authorization="Bearer "+s,i}}async createStreamInOut(s,i){let{query:t,headers:a}=i??{};const r=await this.getAuthData();r&&(r.query&&(t={...t,...r.query}),r.headers&&(a={...a,...r.headers}));const c=t?"?"+f(t):"";return new z(this.baseURL+s+c,a)}async createStreamIn(s,i){let{query:t,headers:a}=i??{};const r=await this.getAuthData();r&&(r.query&&(t={...t,...r.query}),r.headers&&(a={...a,...r.headers}));const c=t?"?"+f(t):"";return new M(this.baseURL+s+c,a)}async createStreamOut(s,i){let{query:t,headers:a}=i??{};const r=await this.getAuthData();r&&(r.query&&(t={...t,...r.query}),r.headers&&(a={...a,...r.headers}));const c=t?"?"+f(t):"";return new K(this.baseURL+s+c,a)}async callAPI(s,i,t,a){let{query:r,headers:c,...L}=a??{};const l={...this.requestInit,...L,method:s,body:t??null};l.headers={...this.headers,...l.headers,...c};const u=await this.getAuthData();u&&(u.query&&(r={...r,...u.query}),u.headers&&(l.headers={...l.headers,...u.headers}));const F=r?"?"+f(r):"",d=await this.fetcher(this.baseURL+i+F,l);if(!d.ok){let h={code:"unknown",message:`request failed: status ${d.status}`};try{const g=await d.text();try{const p=JSON.parse(g);X(p)?h=p:h.message+=": "+JSON.stringify(p)}catch{h.message+=": "+g}}catch(g){h.message+=": "+String(g)}throw new m(d.status,h)}return d}}function X(e){return e!=null&&Z(e.code)&&typeof e.message=="string"&&(e.details===void 0||e.details===null||typeof e.details=="object")}function Z(e){return e!==void 0&&Object.values(A).includes(e)}class m extends Error{constructor(i,t){super(t.message);n(this,"status");n(this,"code");n(this,"details");Object.defineProperty(this,"name",{value:"APIError",enumerable:!1,configurable:!0}),Object.setPrototypeOf==null?this.__proto__=m.prototype:Object.setPrototypeOf(this,m.prototype),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,this.constructor),this.status=i,this.code=t.code,this.details=t.details}}var A=(e=>(e.OK="ok",e.Canceled="canceled",e.Unknown="unknown",e.InvalidArgument="invalid_argument",e.DeadlineExceeded="deadline_exceeded",e.NotFound="not_found",e.AlreadyExists="already_exists",e.PermissionDenied="permission_denied",e.ResourceExhausted="resource_exhausted",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.Unimplemented="unimplemented",e.Internal="internal",e.Unavailable="unavailable",e.DataLoss="data_loss",e.Unauthenticated="unauthenticated",e))(A||{});const ee=_("prod"),o=new W(ee,{}),se=D("auth",{state:()=>({isLoggedIn:!0,isRegistering:!1,session:null,loginForm:{isLoading:!1,username:"",password:""},registerForm:{isLoading:!0,rsid:"",step:1,email:"",otp:[],username:"",password:"",hasAgreedToContact:!0,hasAgreedToTerms:!0}}),actions:{setIsRegistering(e){this.isRegistering=e},async validateSessionToken(){const e=localStorage.getItem("session_token");if(!e){console.log("No session token found."),this.isLoggedIn=!1;return}console.log("Validating session token...");const s=await o.user.ValidateSessionToken({Token:e});if(!s.IsValid){console.error("Session token is invalid."),this.isLoggedIn=!1;return}console.log("Session token is valid."),this.session={token:e,user:s.User}},async login(e,s,i){console.log("Authenticating user..."),this.loginForm.isLoading=!0;const t=await o.user.AuthenticateUser({Username:e,Password:s,ReCAPTCHAToken:i});return this.loginForm.isLoading=!1,t.Success?(console.log("User authenticated successfully."),this.isLoggedIn=!0,this.session={token:t.Token,user:t.User},localStorage.setItem("session_token",t.Token),!0):(console.error("Failed to authenticate user:",t.ErrorCode),!1)},async logout(){console.log("Logging out..."),this.isLoggedIn=!1,this.session=null,localStorage.removeItem("session_token")},async createRegistrationSession(e){console.log("Checking for active registration session..."),this.registerForm.isLoading=!0;const s=localStorage.getItem("rsid");if(s){console.log("Found active registration session. Validating...");const t=await o.verify.CheckRegistrationSession({RSID:s,Email:""});if(t.Success){console.log("Registration session is valid."),this.registerForm.rsid=s,this.registerForm.isLoading=!1;return}else console.log("Registration session is invalid:",t.ErrorCode),localStorage.removeItem("rsid")}else console.log("No active registration session found.");console.log("Creating new registration session...");const i=await o.verify.CreateRegistrationSession({ReCAPTCHAToken:e});if(!i.Success){console.error("Failed to create registration session:",i.ErrorCode);return}console.log("Created registration session:",i.ID),localStorage.setItem("rsid",i.ID),this.registerForm.rsid=i.ID,this.registerForm.isLoading=!1},async checkEmailAvailability(){this.registerForm.isLoading=!0,console.log("Checking email availability...");const e=await o.user.CheckEmail({Email:this.registerForm.email});return this.registerForm.isLoading=!1,{isValid:e.IsValid,isAvailable:e.IsAvailable}},async checkUsernameAvailability(){this.registerForm.isLoading=!0;const e=await o.user.CheckUsername({Username:this.registerForm.username});return this.registerForm.isLoading=!1,{isValid:e.IsValid,isAvailable:e.IsAvailable}},async sendEmailOTP(){console.log("Sending email OTP..."),this.registerForm.isLoading=!0;const e=await o.verify.SendEmailOTP({RSID:this.registerForm.rsid,Email:this.registerForm.email});let s=!1;return e.Success?(console.log("Sent email successfully."),this.registerForm.isLoading=!1,{wasAlreadyVerified:s,waitTime:e.WaitTime}):(console.error("Failed to send email OTP:",e.ErrorCode),e.ErrorCode==="EMAIL_ALREADY_VERIFIED"&&(s=!0),this.registerForm.isLoading=!1,{wasAlreadyVerified:s,waitTime:0})},async resendEmailOTP(){console.log("Resending email OTP..."),this.registerForm.isLoading=!0;const e=await o.verify.ResendEmailOTP({RSID:this.registerForm.rsid,Email:this.registerForm.email});return e.Success||console.error("Failed to resend email OTP:",e.ErrorCode),this.registerForm.otp=[],this.registerForm.isLoading=!1,{isStillFresh:e.ErrorCode==="OTP_STILL_FRESH",waitTime:e.WaitTime}},async validateEmailOTP(e){console.log("Validating email OTP..."),this.registerForm.isLoading=!0;const s=await o.verify.ValidateEmailOTP({RSID:this.registerForm.rsid,Email:this.registerForm.email,Code:e});return this.registerForm.isLoading=!1,s.Success?(console.log("Email OTP validated successfully."),!0):(console.error("Failed to validate email OTP:",s.ErrorCode),!1)},async createUser(e){console.log("Creating user..."),this.registerForm.isLoading=!0;const s=await o.user.CreateUser({RSID:this.registerForm.rsid,Email:this.registerForm.email,Username:this.registerForm.username,Password:this.registerForm.password,ReCAPTCHAToken:e});s.Success||console.error("Failed to create user:",s.ErrorCode),console.log("User created successfully."),this.isLoggedIn=!0,this.session={token:s.Token,user:s.User},localStorage.setItem("session_token",s.Token),this.registerForm.isLoading=!1,this.isRegistering=!1}}}),te={class:"absolute z-50 flex flex-col items-center justify-center w-full h-full bg-black"},ie=C("div",{class:"w-[15%] aspect-square bg-center bg-contain bg-no-repeat",style:{"background-image":"url(/desktop/os-logo.png)"}},null,-1),ae=N({__name:"HomeView",setup(e){const s=O(()=>T(()=>import("./AuthView-BUrdN3Pj.js"),__vite__mapDeps([0,1,2,3]))),i=O(()=>T(()=>import("./DesktopView-Cu-wA8Ox.js").then(r=>r.D),__vite__mapDeps([4,3,1,2,5,6]))),t=se();t.validateSessionToken();const a=j(()=>t.isLoggedIn);return(r,c)=>a.value?(y(),v(V,{key:1},{fallback:P(()=>[C("div",te,[ie,I(x)])]),default:P(()=>[I(b(i))]),_:1})):(y(),v(b(s),{key:0}))}}),oe=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"}));export{oe as H,q as _,se as u};
